{% extends "base.html" %}
{% set title = "送り（vf ↔ fz）- 加工条件 電卓" %}

{% block content %}
<section class="card">
    <h2>送り（vf ↔ fz）</h2>

    <!-- RPM source tabs -->
    <div class="tabs" role="tablist" aria-label="回転数の入力方式">
        <button type="button" class="tab active" role="tab" aria-selected="true" id="tab_rpm_direct"
            data-tab="rpm_direct">
            n を直接入力
        </button>
        <button type="button" class="tab" role="tab" aria-selected="false" id="tab_rpm_from_vc" data-tab="rpm_from_vc">
            D & Vc から n
        </button>
    </div>

    <div class="grid">
        <!-- Tab A: direct RPM -->
        <div class="panel" id="panel_rpm_direct">
            <label class="field">
                <span>回転数 n（rpm）</span>
                <input id="rpm" type="number" inputmode="decimal" step="1" min="0" value="10000" readonly
                    data-numpad="int">
            </label>
        </div>

        <!-- Tab B: diameter + cutting speed -> RPM -->
        <div class="panel hidden" id="panel_rpm_from_vc">
            <label class="field">
                <span>工具径 D（mm）</span>
                <input id="diameter_mm" type="number" inputmode="decimal" step="0.01" min="0" value="10" readonly
                    data-numpad="decimal">
            </label>

            <label class="field">
                <span>周速 Vc（m/min）</span>
                <input id="vc_mmin" type="number" inputmode="decimal" step="0.1" min="0" value="200" readonly
                    data-numpad="decimal">
            </label>

            <div class="row" style="margin-top: 0;">
                <button id="btn_calc_rpm_from_vc" class="btn btn-sub">D と Vc から n を計算</button>
                <span class="mono" id="rpm_from_vc_preview"></span>
            </div>
        </div>

        <!-- Common inputs -->
        <label class="field">
            <span>刃数 z（teeth）</span>
            <input id="teeth" type="number" inputmode="numeric" step="1" min="0" value="4" readonly data-numpad="int">
        </label>

        <label class="field">
            <span>送り速度 vf（mm/min）</span>
            <input id="vf" type="number" inputmode="decimal" step="1" min="0" value="" readonly data-numpad="int">
        </label>

        <label class="field">
            <span>1刃送り fz（mm/tooth）</span>
            <input id="fz" type="number" inputmode="decimal" step="0.001" min="0" value="0.05" readonly
                data-numpad="decimal">
        </label>
    </div>

    <div class="row">
        <button id="btn_calc_vf" class="btn">n・z・fz から vf を計算</button>
        <button id="btn_calc_fz" class="btn">n・z・vf から fz を計算</button>
        <a class="btn btn-sub" href="/">トップへ戻る</a>
    </div>

    <div id="msg" class="msg" aria-live="polite"></div>
    <div class="note">
        式：vf = fz × z × n（vf: mm/min, fz: mm/tooth, z: teeth, n: rpm）
    </div>
</section>
{% endblock %}

{% block scripts %}
<script src="/js/calculators/feed.js"></script>
<script src="/js/calculators/cutting_speed.js"></script>
<script src="/js/page_feed.js"></script>
{% endblock %}